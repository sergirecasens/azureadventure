<!DOCTYPE html>

<html>
<head>
	<script src="./bundle.js"></script>
	<script src="./bundle2.js"></script>
	<script>
		console.log(require('dotenv-azure'));
		async function main()
		{
			await new DotenvAzure().config();
			console.log(process.env.AZURE_STORAGE_CONNECTION_STRING);
		}
		main();
	</script>
	<link rel="stylesheet" href="./style.css">
	<title>Men√∫</title>
</head>

<body class="bg">
	<b class="texttitol">The Adventurer's Adventure</b>
	<button class="botocentrat" onClick="startGame()">Start Game</button>
	<button class="botocentrat" onClick="load()">Load</button>
	<button class="botocentrat" onClick="ranking()">Ranking</button>
</body>

<script>
	let partida = {id:1, name:undefined, time:0};
	//let partides;
		
	let user = prompt("Enter your username", "");
	sessionStorage.setItem("user", user);
	partida.name = user;
	

	function load(){
		window.location="./html/load.html";
	}

	function ranking(){
		window.location="./html/ranking.html";
	}
	
	function startGame(){
		if(partida.name){
			/*partides = localStorage.getItem("llistat_partides");
		
			if (!partides){
				partides = [];
			}
			else{
				partides = JSON.parse(partides);
				if(partides.length > 0)
					partida.id = partides[partides.length - 1].id + 1;
			}
		
			partides.push(partida);
			localStorage.setItem("llistat_partides", JSON.stringify(partides));*/

			let xhr = new XMLHttpRequest();
			xhr.open("POST", "https://adventureefunc.azurewebsites.net/api/HttpTriggerSet?code=3127ueiKO4AF1CyOqXYgrk9yWgv4LHDx9sIKp35zIUGpAzFulXepkg==");

			xhr.setRequestHeader("Accept", "application/json");
			xhr.setRequestHeader("Content-Type", "application/json");

			xhr.onload = () => {
				let res = JSON.parse(xhr.responseText);
				console.log(res);
				sessionStorage.setItem("id_partida", res.body);
				alert("Ara canviara de pagina. Mira la consola abans de treure aquest alert!");
				window.location = "./html/game.html";
			}

			let data = {
				game_data: partida,
				type: 0
			};
			
			let jsonData = JSON.stringify(data);

			xhr.send(jsonData);
		}
	}
</script>
</html>